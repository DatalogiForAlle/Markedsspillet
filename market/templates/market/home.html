{% extends "market/base.html" %}
{% load crispy_forms_tags %}
{% load i18n %}

{% block title %}{% translate 'Home' %}{% endblock %}

{% block content %}
<h4 class="mb-4">{% translate 'Welcome to the Market Simulator' %}</h4>

<div class="row">
    <!-- Col with options for "traders" -->
    <div class="col col-12 col-lg-6 d-flex align-items-stretch">
        <div class="card">
            <div class="card-header">
                {% translate 'Join a market' %}
            </div>
            
            <div class="card-body container">
            
                {% if request.session.market_id %}
                    <!-- Warn users who have already joined a market -->
                    <div class="alert alert-warning">
                        Hi {{ request.session.username }}! You've already joined the {{ market.product_name_plural}} market {{ market.market_id }}.
                        If you submit the form below, you will permanenly lose access to this market. 
                        <a href="{% url 'market:play' market.market_id %}">Return to your market </a>
                    </div>
                {% endif %} 
                    <!-- Content if client has not joined a market -->
                    {% comment %} <p>{% translate 'Traders produce and sell goods on a market. They compete with other traders to gain the most money after a given number of rounds.'%}</p> {% endcomment %}

                    <form action="" method="post">{% csrf_token %}
                        {{ form|crispy }}
                        <div class="d-flex justify-content-center">
                            <input type="submit" value="{% translate "Join market" %}" class="btn btn-primary my-2">
                        </div>
                    </form>
            </div>
        </div>
    </div>
    <!-- Col with options for "hosts" -->
    
    <div class="col col-12 col-lg-6 mt-5 mb-3 my-lg-0">
        <div class="card mb-4">
            <div class="card-header">
                {% translate 'Host a market' %}
            </div>
            <div class="card-body container">
                {% if user.is_authenticated %}     

                <p>Hosts are game masters who create and control markets. Do you want to host a new market?</p>
                <div class="d-flex justify-content-center p">
                    <a class="pr-2" href="{% url 'market:create_market' %}">
                        <button class="btn btn-primary">
                            {% translate 'Create a new market' %}      
                        </button>
                    </a>
                </div>
                <p class="mt-3">Perhaps you have created some markets earlier? You have the option to revisit those markets too:</p>
                <div class="d-flex justify-content-center p">
                    <a class="pl-2 mb-3" href="{% url 'market:my_markets' %}">
                        <button class="btn btn-primary">
                            {% translate 'My markets' %}      
                        </button>
                    </a>
                </div>

                {% else %}
                <p class="mt-2">Hosts are game masters who create and control markets. Do you want to host a new market? Or revisit a market you created earlier?</p>                            
                <div class="d-flex justify-content-center p">
                    <a class="mr-2" href="{% url 'account_login' %}">
                        <button class="btn btn-primary">
                                {% translate 'Log in' %}      
                        </button>
                    </a>
                </div>
    
                <p class="mt-4">If you do not yet have an account, you can create one here:</p>                            

                <div class="d-flex mb-2 justify-content-center">
            
                    <a class="ml-2" href="{% url 'account_signup' %}">
                        <button class="btn btn-primary">
                            {% translate 'Create account' %}      
                        </button>
                    </a>
                </div>
                
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% if request.session.market_id %}
<script>
    // if client has already joined a game, fill out name field
    document.getElementById('id_name').value = "{{ request.session.username }}"
</script>
{% endif %}

{% endblock %}
